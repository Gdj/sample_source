<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>sample_find_item_text</title>
  <script type="text/javascript" src="./js/library/jquery-1.12.1.min.js"></script>
  <style>
    .find-box       { display: none; align-items: center; position: fixed; top:0; background-color:rgba(200,200,200, .5);}
    .find-box.show  { display: flex; }
    .scroll-box  { height: 200px; overflow-y: auto;}
    .count-box   { margin: 0 10px;}

    .find_matched { color: #eee; background-color: #39f; }
    .find_matched:focus, .find_matched.focusOn { color: #eee; background-color: #f9f; }
  </style>

  <body>
    <center>
      <br><br>
    <h2>ctrl+F기능</h2>
    <div>
      <!-- 이부분은 찾기하지 않게"pl&lt;highlightStartTag&gt;ant&lt;highlightEndTag&gt;")&\/';"-->
      <p>
        <h3>하이라이트 찾기기능</h3>
      </p>
    </div>
    </center>

    <div class="find-box js-text_find_ui-area">
      <input type="txt" id=""           class="js-findKey"  >
      <input type="button" value="찾기" class="js-find-btn" >
      <span class="count-box"><em>0</em>/<b>0</b></span>
      <button class="js-btn_prev">▲</button>
      <button class="js-btn_next">▼</button>
      <button class="js-find_area-close">X</button>
      <!-- <input type="button" value="원상복귀" onclick="saveOriginSource_restoration('.js-find_textdata');"> -->
    </div>

    
      <br>
      <h2>찾기 영역 복수 :  js-find_textdata li</h2>
      <div class="js-find_textdata scroll-box">
        <ul class="">
          <li> 안녕 오늘도 같은 자리 버스 창가에
            기대 앉은 네게 인사를 해 Hi
            역시 넌 받아 주지를 않네
            인기 많고 잘생긴 넌 내게만
            그렇게 쌀쌀하게 굴더라</li>
      
          <li>근데 Last Night 기억나?
            넌 내가 좋다고 했어
            그 예쁜 가로등 아래서
            넌 내가 좋다고 말했어
            다음부턴 모른 척 아닌 척해도
            You Have To Know That
            확신을 해야 돼 넌
            그 날 넌 내가 좋다고 했어 Yeah</li>
      
          <li>If You Like Me Or Love Me
            Just Say Yes Yes Yes
            And Then I'm Your Girlfriend
            And You're My Boyfriend
            어서 내게 좋다고 말해줘</li>
      
          <li>몰래 오늘도 도서관 맨 앞자리에
            기대 앉은 네게 인사를 해 Oh Boy
            역시 넌 받아 주지를 않네
            인기 많고 잘생긴 넌 내게만
            그렇게 쌀쌀하게 굴더라
          </li>
          <li>
            근데 Last Night 기억나?
            넌 내가 좋다고 했어
            그 예쁜 가로등 아래서
            넌 내가 좋다고 말했어
            다음부턴 모른 척 아닌 척해도
            You Have To Know That
            확신을 해야 돼 넌
            그 날 넌 내가 좋다고 했어 Yeah
          </li>
      
          <li>
            If You Like Me Or Love Me
            Just Say Yes Yes Yes
            And Then I'm Your Girlfriend
            And You're My Boyfriend
            어서 내게 좋다고 말해줘 Oh
          </li>
      
          <li>
            널 참 많이 좋아하는 난데
            우린 이어질 수 없는 걸까
            내 긴 교복 치마가 부끄러워 초라해 Yeah
            네 곁엔 항상 키 크고
            예쁜 애들이 넘치는데 Woo
          </li>
      
          <li>
            If ou Like Me If You Love Me Yeah
            And Then I'm Your Girlfriend
            And You're My Boyfriend
            어서 내게 좋다고 말해줘
            If You Like Me Or Love Me
            Just Say Yes Yes Yes
            And Then I'm Your Girlfriend
            And You're My Boyfriend
            어서 내게 좋다고 말해줘
          </li>
        </ul>
        <ul class="">
          <li> 안녕 오늘도 같은 자리 버스 창가에
            기대 앉은 네게 인사를 해 Hi
            역시 넌 받아 주지를 않네
            인기 많고 잘생긴 넌 내게만
            그렇게 쌀쌀하게 굴더라</li>
      
          <li>근데 Last Night 기억나?
            넌 내가 좋다고 했어
            그 예쁜 가로등 아래서
            넌 내가 좋다고 말했어
            다음부턴 모른 척 아닌 척해도
            You Have To Know That
            확신을 해야 돼 넌
            그 날 넌 내가 좋다고 했어 Yeah</li>
      
          <li>If You Like Me Or Love Me
            Just Say Yes Yes Yes
            And Then I'm Your Girlfriend
            And You're My Boyfriend
            어서 내게 좋다고 말해줘</li>
      
          <li>몰래 오늘도 도서관 맨 앞자리에
            기대 앉은 네게 인사를 해 Oh Boy
            역시 넌 받아 주지를 않네
            인기 많고 잘생긴 넌 내게만
            그렇게 쌀쌀하게 굴더라
          </li>
          <li>
            근데 Last Night 기억나?
            넌 내가 좋다고 했어
            그 예쁜 가로등 아래서
            넌 내가 좋다고 말했어
            다음부턴 모른 척 아닌 척해도
            You Have To Know That
            확신을 해야 돼 넌
            그 날 넌 내가 좋다고 했어 Yeah
          </li>
      
          <li>
            If You Like Me Or Love Me
            Just Say Yes Yes Yes
            And Then I'm Your Girlfriend
            And You're My Boyfriend
            어서 내게 좋다고 말해줘 Oh
          </li>
      
          <li>
            널 참 많이 좋아하는 난데
            우린 이어질 수 없는 걸까
            내 긴 교복 치마가 부끄러워 초라해 Yeah
            네 곁엔 항상 키 크고
            예쁜 애들이 넘치는데 Woo
          </li>
      
          <li>
            If ou Like Me If You Love Me Yeah
            And Then I'm Your Girlfriend
            And You're My Boyfriend
            어서 내게 좋다고 말해줘
            If You Like Me Or Love Me
            Just Say Yes Yes Yes
            And Then I'm Your Girlfriend
            And You're My Boyfriend
            어서 내게 좋다고 말해줘
          </li>
        </ul>
      </div>

    </div>





    <script>
      /*
      * trpRemoveClassPrefix   : 특정문자열로 시작되는 클래스 삭제
      * @param	$prefix			    : 특정문자열
      */
      jQuery.fn.trpRemoveClassPrefix = function($prefix) {
        this.each(function(i, el) {
          var classes = el.className.split(" ").filter(function(c) {
            return c.lastIndexOf($prefix, 0) !== 0;
          });
          el.className = $.trim(classes.join(" "));
        });
        return this;
      };
      

      /** 
       * trpFindTextItemMove
       * @option $find_area         : 검색영역
       * @option $find_input        : 검색어
       * @method getSearchFn        : 검색어 찾기
       * @method getSearchCancelFn  : 검색 초기화
       */
      function trpFindTextItemMove($find_area, $find_input){
        let find_area  = $find_area;  // 검색영역
        let find_input = $find_input; // 검색어
        /* (init) */
        $(find_area).each(function(){ 
          $(this).data("title", $(this).text() );       // 텍스트 > title 삽입 
        })

        return {
          /* 검색어 찾기 */
          getSearchFn(){ 
            var inputText = $(find_input).val();          // 검색어
            var regex     = new RegExp(inputText, 'gi');  // 입력 글자 정규식
            var findAare  = $(find_area);                 // 검색영역
            console.log("검색어  : ", inputText);
            findAare.each(function($index){
              var str = $(this).data("title");
              $(this).text(str);
              $(this).removeClass('focus_tar');
              $(this).trpRemoveClassPrefix('focus-');

              /// var _strLC    = str.toLowerCase();        // 대상글자- 소문자
              /// var _inputLC  = inputText.toLowerCase();  // 검색글자- 소문자
              /// if( _strLC.match(_inputLC) ){                      
              ///   //var re  = str.replaceAll(regex, '<em class="match" tabindex="0">'+inputText+'</em>' );
              ///   var re  = _strLC.replaceAll(regex, '<em class="match" tabindex="0">'+inputText+'</em>' );
              ///   $(this).html(re);
              ///   $(".match").closest(find_area).addClass('focus_tar');
              /// }

              const matches = [...str.matchAll(regex)];
              if(matches.length == 0) return;
              console.log('matches : ', matches)
              for( var i = 0; i < matches.length; i++ ){
                // console.log( "item ::", matches[i] );
                var re     = str.replace(regex, '<em class="find_matched" tabindex="0">'+matches[0]+'</em>' );
                $(this).html(re);
                $(".match").closest(find_area).addClass('focus_tar');
              }

            });


            //console.log('match_total', match_total);
            $(".match").each(function($index){
              $(this).addClass('focus-'+$index);
            })
          },
          /* 검색 초기화 */
          getSearchCancelFn(){
            $(find_input).val("");                        // 검색어
            var findAare = $(find_area);                  // 검색영역
            findAare.each(function($index){
              var str = $(this).data("title");
                $(this).text(str);
                $(this).removeClass('focus_tar');
                $(this).trpRemoveClassPrefix('focus-');
            })
          }
        }
      }  

      window.findUI = new trpFindTextItemMove(".js-find_textdata li", ".js-findKey");
    </script>


    <!-- =========== find UI ========  -->
    <script>
      /* --- 찾기 열고, 닫기 : ctrl + f 키  (Event)--- */
      var ctrlB = false;
      $("body").on("keydown", function($e){
        if($e.keyCode == 17){
          ctrlB = true;
        }
        if($e.keyCode == 70 && ctrlB == true){
          $e.preventDefault();
          console.log("=== 실행 : ctrl + f ===")
          openFind();
        }
      })   
      $(".js-find_area-close").on("click", function(){
        closeFind();                // 닫기
      })
      /* 찾기 열기 (function) */
      function openFind(){
        $(".js-text_find_ui-area").addClass("show");                                        // 검색창 열기
        setTimeout(function(){ $(".js-text_find_ui-area input[type='txt']").focus() },10);  // 검책창 포커스 이동
        setFous();                    // 포커스 리세팅
      }
      /* 찾기 닫기 (function)*/
      function closeFind(){
        ctrlB = false;
        $(".js-findKey").val("");     // 검색어 삭제
        window.findUI.getSearchCancelFn();    // 검색 리셋
        $(".js-text_find_ui-area").removeClass("show");     // 검색창 닫기
      }
      
      /* --- 찾기 시작 (엔터) --- */
      $(".js-findKey").on("keypress", function($e){
        if ($e.keyCode == 13) window.findUI.getSearchFn();
        setFous();          // 포커스 매칭 세팅
      })
      /* --- 찾기 시작 (버튼) --- */
      $(".js-find-btn").on("click", function($e){
        window.findUI.getSearchFn();
        setFous();         // 포커스 매칭 세팅
      })

      
      /* --- 포커스 이동 --- */
      var _focusIdx = -1;
      var _focusTotal = 0;
      function setFous(){
        console.log("포커스 초기화")
        _focusIdx = -1;
        _focusTotal = $(".find_matched").length;
        $(".find_matched").each(function($idx, $item){
          $($item).attr("tabindex", 0);
        });

        // 카운트 
        $(".count-box em").text(_focusIdx + 1);
        $(".count-box b").text(_focusTotal);
      }

      $(".js-btn_prev").on("click", function($e){
        _focusIdx -= 1;
        _focusTotal  = $(".find_matched").length;

        if (_focusIdx < 0) { _focusIdx = _focusTotal - 1 }
        focusMove(_focusIdx, _focusTotal);
      })
      $(".js-btn_next").on("click", function($e){
        _focusIdx += 1;
        _focusTotal  = $(".find_matched").length;
        
        if (_focusIdx >= _focusTotal) { _focusIdx = 0 }
        focusMove(_focusIdx, _focusTotal);
      })
      function focusMove($focusIdx, $focusTotal){
        //console.log( _focusTotal , '_focusIdx : ', _focusIdx)
        $(".count-box em").text($focusIdx + 1);
        $(".count-box b").text($focusTotal);
        $(".find_matched").removeClass("focusOn");
        $(".find_matched").eq($focusIdx).addClass("focusOn").focus(); 
      }
    </script>

   
</body>
</html>
